form.addEventListener('submit', (e) => {
    e.preventDefault();

    const tournament = document.getElementById('tournament').value;
    const score = scoreInput.value.trim();

    // Проверка корректности формата счета
    const scoreMatch = score.match(/^(\d+):(\d+)$/);
    if (!scoreMatch) {
        alert('Введите корректный счет в формате X:Y (например, 2:1).');
        return;
    }

    const homeGoals = parseInt(scoreMatch[1], 10);
    const awayGoals = parseInt(scoreMatch[2], 10);

    // Логика для пенальти
    let penaltyWinner = null;
    if ((tournament === 'qualification' || tournament === 'weekend_league') && homeGoals === awayGoals) {
        const penaltyScore = document.getElementById('penalty').value.trim();
        const penaltyMatch = penaltyScore.match(/^(\d+):(\d+)$/);

        if (!penaltyMatch) {
            alert('Для этого турнира требуется ввести счет пенальти.');
            return;
        }

        const penaltyHome = parseInt(penaltyMatch[1], 10);
        const penaltyAway = parseInt(penaltyMatch[2], 10);
        penaltyWinner = penaltyHome > penaltyAway ? 'home' : 'away';
    }

    // Обновление статистики и истории
    updateStats(tournament, homeGoals, awayGoals, penaltyWinner);
    matchHistory.push({ tournament, homeGoals, awayGoals, penaltyWinner });

    // Очистка формы и сохранение данных
    form.reset();
    document.getElementById('tournament').value = tournament; // Сохраняем выбранный турнир
    penaltyInput.style.display = 'none';

    saveStats();
    displayStats();
    displayResults();
});

scoreInput.addEventListener('input', () => {
    const tournament = document.getElementById('tournament').value;
    const score = scoreInput.value.trim();

    // Если счет ничейный и турнир требует пенальти, отображаем поле ввода пенальти
    const scoreMatch = score.match(/^(\d+):(\d+)$/);
    if (scoreMatch) {
        const homeGoals = parseInt(scoreMatch[1], 10);
        const awayGoals = parseInt(scoreMatch[2], 10);

        if (homeGoals === awayGoals && (tournament === 'qualification' || tournament === 'weekend_league')) {
            penaltyInput.style.display = 'block';
        } else {
            penaltyInput.style.display = 'none';
        }
    }
});
