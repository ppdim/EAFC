<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EA FC 25 Stats</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-weight: 400;
      text-align: center;
      margin: 20px 0;
    }

    label, select, input, button {
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    button {
      font-weight: bold;
      padding: 10px 20px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }

    button:hover {
      background-color: #45a049;
    }

    .danger {
      background-color: #f44336;
    }

    .danger:hover {
      background-color: #e53935;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
      width: 100%;
      max-width: 1200px;
      margin-top: 20px;
    }

    .stat-card {
      width: calc(33% - 20px);
      background-color: #fff;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      margin-bottom: 10px;
    }

    .stat-card p {
      margin: 5px 0;
    }

    #penalty-score {
      display: none;
      margin-top: 10px;
    }

    .buttons {
      margin-top: 20px;
    }

    .buttons button {
      margin-right: 10px;
    }

    .results-container {
      margin-top: 20px;
      width: 100%;
      max-width: 1200px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f4f4f4;
    }
  </style>
</head>
<body>
  <h1>EA FC 25 Stats</h1>

  <form id="match-form">
    <label for="tournament">Choose a Tournament:</label>
    <select id="tournament" required>
      <option value="rivals">Rivals</option>
      <option value="qualification">Qualification Weekend League</option>
      <option value="weekend_league">Weekend League</option>
    </select>

    <label for="score">Enter Score (e.g., 2:1):</label>
    <input type="text" id="score" required placeholder="Enter score (e.g., 2:1)" />

    <div id="penalty-score">
      <label for="penalty">Enter Penalty Score (e.g., 3:2):</label>
      <input type="text" id="penalty" placeholder="Enter penalty score (e.g., 3:2)" />
    </div>

    <button type="submit">Submit Match</button>
  </form>

  <div class="buttons">
    <button id="delete-last">Delete Last Match</button>
    <button id="clear-all" class="danger">Clear All Statistics</button>
  </div>

  <div id="stats" class="stats-container"></div>

  <div class="results-container">
    <h2>Match History</h2>
    <table>
      <thead>
        <tr>
          <th>Tournament</th>
          <th>Score</th>
          <th>Penalty</th>
        </tr>
      </thead>
      <tbody id="results-body"></tbody>
    </table>
  </div>

  <script>
    const stats = {
      rivals: { games: 0, wins: 0, losses: 0, draws: 0, goalsScored: 0, goalsConceded: 0 },
      qualification: { games: 0, wins: 0, losses: 0, goalsScored: 0, goalsConceded: 0 },
      weekend_league: { games: 0, wins: 0, losses: 0, goalsScored: 0, goalsConceded: 0 },
    };

    const matchHistory = [];

    const form = document.getElementById('match-form');
    const statsDiv = document.getElementById('stats');
    const resultsBody = document.getElementById('results-body');
    const penaltyInput = document.getElementById('penalty-score');
    const scoreInput = document.getElementById('score');

    function saveStats() {
      localStorage.setItem('stats', JSON.stringify(stats));
      localStorage.setItem('matchHistory', JSON.stringify(matchHistory));
    }

    function loadStats() {
      const savedStats = JSON.parse(localStorage.getItem('stats'));
      const savedHistory = JSON.parse(localStorage.getItem('matchHistory'));

      if (savedStats) {
        for (let key in stats) {
          stats[key] = savedStats[key];
        }
      }

      if (savedHistory) {
        matchHistory.push(...savedHistory);
      }
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const tournament = document.getElementById('tournament').value;
      const score = scoreInput.value.trim();

      const scoreMatch = score.match(/^(\d+):(\d+)$/);
      if (!scoreMatch) {
        alert('Please enter a valid score in the format X:Y (e.g., 2:1).');
        return;
      }

      const homeGoals = parseInt(scoreMatch[1], 10);
      const awayGoals = parseInt(scoreMatch[2], 10);

      let penaltyWinner = null;
      if ((tournament === 'qualification' || tournament === 'weekend_league') && homeGoals === awayGoals) {
        const penaltyScore = document.getElementById('penalty').value.trim();
        const penaltyMatch = penaltyScore.match(/^(\d+):(\d+)$/);

        if (!penaltyMatch) {
          alert('Penalty score is required for this tournament.');
          return;
        }

        const penaltyHome = parseInt(penaltyMatch[1], 10);
        const penaltyAway = parseInt(penaltyMatch[2], 10);
        penaltyWinner = penaltyHome > penaltyAway ? 'home' : 'away';
      }

      updateStats(tournament, homeGoals, awayGoals, penaltyWinner);
      matchHistory.push({ tournament, homeGoals, awayGoals, penaltyWinner });

      form.reset();
      document.getElementById('tournament').value = tournament; // сохраняем выбранный турнир
      penaltyInput.style.display = 'none';

      saveStats();
      displayStats();
      displayResults();
    });

    function updateStats(tournament, homeGoals, awayGoals, penaltyWinner) {
      stats[tournament].games++;
      if (homeGoals > awayGoals || penaltyWinner === 'home') {
        stats[tournament].wins++;
      } else if (homeGoals < awayGoals || penaltyWinner === 'away') {
        stats[tournament].losses++;
      } else {
        stats[tournament].draws++;
      }
      stats[tournament].goalsScored += homeGoals;
      stats[tournament].goalsConceded += awayGoals;
    }

    function displayStats() {
      statsDiv.innerHTML = Object.keys(stats).map((key) => {
        const { games, wins, losses, draws, goalsScored, goalsConceded } = stats[key];
        return `
          <div class="stat-card">
            <h3>${key.replace('_', ' ').toUpperCase()}</h3>
            <p>Games: ${games}</p>
            <p>Wins: ${wins}</p>
            <p>Losses: ${losses}</p>
            ${key === 'rivals' ? `<p>Draws: ${draws}</p>` : ''}
            <p>Goals Scored: ${goalsScored}</p>
            <p>Goals Conceded: ${goalsConceded}</p>
          </div>`;
      }).join('');
    }

    function displayResults() {
      resultsBody.innerHTML = matchHistory.map((match) => {
        const { tournament, homeGoals, awayGoals, penaltyWinner } = match;
        return `
          <tr>
            <td>${tournament.replace('_', ' ').toUpperCase()}</td>
            <td>${homeGoals}:${awayGoals}</td>
            <td>${penaltyWinner ? penaltyWinner.toUpperCase() : 'N/A'}</td>
          </tr>`;
      }).join('');
    }

    document.getElementById('delete-last').addEventListener('click', () => {
      if (matchHistory.length > 0) {
        const lastMatch = matchHistory.pop();
        stats[lastMatch.tournament].games--;
        if (lastMatch.homeGoals > lastMatch.awayGoals || lastMatch.penaltyWinner === 'home') {
          stats[lastMatch.tournament].wins--;
        } else if (lastMatch.homeGoals < lastMatch.awayGoals || lastMatch.penaltyWinner === 'away') {
          stats[lastMatch.tournament].losses--;
        } else {
          stats[lastMatch.tournament].draws--;
        }
        stats[lastMatch.tournament].goalsScored -= lastMatch.homeGoals;
        stats[lastMatch.tournament].goalsConceded -= lastMatch.awayGoals;

        saveStats();
        displayStats();
        displayResults();
      }
    });

    document.getElementById('clear-all').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear all statistics?')) {
        for (let key in stats) {
          stats[key] = { games: 0, wins: 0, losses: 0, draws: 0, goalsScored: 0, goalsConceded: 0 };
        }
        matchHistory.length = 0;

        saveStats();
        displayStats();
        displayResults();
      }
    });

    window.onload = () => {
      loadStats();
      displayStats();
      displayResults();
    };
  </script>
</body>
</html>
